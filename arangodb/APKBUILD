# Maintainer: Mike Williamson <mike@korora.ca>
pkgname=arangodb
pkgver=3.3.14
pkgrel=0
pkgdesc="A multi-model NoSQL database, combining key-value, document and graph data models."
url="https://www.arangodb.com/"
arch="x86_64"
pkgusers="arangodb"
pkggroups="arangodb"
options="!check"
license="APACHE"
depends="openssl curl zlib"
makedepends="cmake openssl-dev zlib-dev python2 icu boost linux-headers alpine-sdk"
install="arangodb.pre-install"
subpackages="$pkgname-doc"
validpgpkeys="CD8CB0F1E0AD5B52E93F41E7EA93F5E56E751E9B" # Frank Celler (ArangoDB Debian Repository) <info@arangodb.com>
source="
	https://www.arangodb.com/repositories/Source/ArangoDB-$pkgver.tar.bz2
	https://www.arangodb.com/repositories/Source/ArangoDB-${pkgver}.tar.bz2.asc
	$pkgname.initd
	$pkgname.pre-install
	"
builddir="$srcdir/"

build() {
	cd "$builddir"
  msg2 "Configuring ArangoDB."
  cd $srcdir/ArangoDB-$pkgver
  [ -d build ] || mkdir build && cd build
  cmake -DCMAKE_BUILD_TYPE=Release \
    -DCMAKE_INSTALL_PREFIX=/usr \
    -DCMAKE_INSTALL_PREFIX:PATH=/ \
    -DCMAKE_SKIP_RPATH=On \
    ..
  msg2 "Building ArangoDB."
  make -j $(nproc)
}

package() {
  cd "$builddir"
  msg2 "Preparing ArangoDB."
  mkdir -p $pkgdir/usr/bin
  cp -R $srcdir/ArangoDB-$pkgver/build/etc $pkgdir
  cp -R $srcdir/ArangoDB-$pkgver/build/var $pkgdir
  cp -R $srcdir/ArangoDB-$pkgver/build/bin/* $pkgdir/usr/bin/

  cd "$pkgdir"

  install -d -o arangodb -g arangodb \
	usr/share/arangodb3/js \
	usr/share/man \
	var/lib/arangodb3 \
	var/lib/arangodb3-apps \
	var/log/arangodb3

  cp -R $srcdir/ArangoDB-$pkgver/js/* usr/share/arangodb3/js
  cp -R $srcdir/ArangoDB-$pkgver/Documentation/man/* usr/share/man

  install -D -m644 $srcdir/ArangoDB-"$pkgver"/Installation/logrotate.d/arangod.systemd "$pkgdir"/etc/logrotate.d/arangodb3
  install -D -m644 $srcdir/ArangoDB-$pkgver/LICENSE "${pkgdir}/usr/share/licenses/arangodb3/LICENSE"
}

sha512sums="1af1d20ad5ce1f69d07fc35449b6d352122f63f37482b822e362bc4a3d90ac0a635cb55e9e4a26e7749d5d29dc26e19a0464cbea6e98f136fda4b8e0d736fb5a  ArangoDB-3.3.14.tar.bz2
e6d27a5353e824f62adb8e7a37e9e4c707e4d5869999e8d24a4d2f413790165a5c2fc813aa567620dde71256ed6713a38b6f03fac2e83db22e0e6baf7fdac321  ArangoDB-3.3.14.tar.bz2.asc
9c0757ec3af25bad4a24f66130d96bc618117140fe4b88553c4ff68fabe99b78ea5a9a2b38e650555f4f1eb99da53162e4182b51a29a7a5ef8a67af21fbc3de5  arangodb.initd
94ce1489ba23029c89b7045908682aa23e49311a701082d2faca933424ba4537838cc6b5185d932052ca00fc73db8e30c0ff905dd0c6fa6969246f74e4f52624  arangodb.pre-install
"
